# Repeat run GIS osm2pgsql workload until prompted to stop.
# Execute "touch complete" to signal when you want the testing to end.
# Configure via environment variables.
# Expected to be run via the nohup command.

# Set in seconds, default gives one hour recovery time between runs
if [ -n "$RECOVERY"] ; then
  RECOVERY=3600
fi
 
while [ ! -f complete ] ; do
  util/newgis
  sudo /usr/local/bin/bench_tune
  # TODO Maybe not sleep before first run?  Command line param?
  echo Waiting $RECOVERY seconds for disk to recover its cache
  sleep $RECOVERY
  ./runset &
  P=$!
  wait $P
done
